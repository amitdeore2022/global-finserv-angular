# Firebase Firestore Data Structure for Global Financial Services

## Collections Overview

### 1. **customers** Collection
- **Purpose**: Store customer information
- **Document ID**: Auto-generated by Firestore
- **Structure**:
```javascript
{
  "id": "auto-generated-document-id",
  "name": "Mr. Rahul Sharma",
  "mobile": "+91 9876543210",
  "email": "rahul.sharma@email.com",
  "address": "123 MG Road, Mumbai, Maharashtra - 400001",
  "gst": "GST123456789",
  "dueAmount": 0,
  "createdAt": "2025-07-19T10:29:38.000Z",
  "updatedAt": "2025-07-19T10:29:38.000Z"
}
```

### 2. **invoices** Collection
- **Purpose**: Store invoice information
- **Document ID**: Auto-generated by Firestore
- **Structure**:
```javascript
{
  "id": "auto-generated-document-id",
  "invoiceNumber": "INV-202507-0001",
  "invoiceDate": "2025-07-19",
  "customer": {
    "id": "customer-document-id",
    "name": "Mr. Rahul Sharma",
    "mobile": "+91 9876543210",
    "email": "rahul.sharma@email.com",
    "address": "123 MG Road, Mumbai, Maharashtra - 400001",
    "gst": "GST123456789"
  },
  "serviceDetails": [
    {
      "description": "Web Development",
      "quantity": 1,
      "rate": 50000,
      "amount": 50000,
      "notes": "Complete website development"
    }
  ],
  "totalAmount": 50000,
  "advanceReceived": 10000,
  "balancePayable": 40000,
  "selectedBank": "HDFC Bank",
  "status": "PENDING", // PENDING | PAID | PARTIAL
  "createdAt": "2025-07-19T10:29:38.000Z",
  "updatedAt": "2025-07-19T10:29:38.000Z"
}
```

## Data Relationships

### Customer â†” Invoice Linkage
The relationship between customers and invoices is established through:

1. **Invoice stores complete customer snapshot**:
   - When creating an invoice, the customer's complete information is embedded
   - This includes customer ID for reference linkage
   - Customer details are snapshot at the time of invoice creation

2. **Customer ID Reference**:
   - `invoices.customer.id` references the document ID from the `customers` collection
   - This allows querying all invoices for a specific customer
   - Enables updates to customer master data without affecting historical invoices

## Query Patterns

### 1. Get all invoices for a specific customer:
```javascript
const customerInvoices = await db.collection('invoices')
  .where('customer.id', '==', customerId)
  .orderBy('createdAt', 'desc')
  .get();
```

### 2. Get customer with their invoice summary:
```javascript
const customer = await db.collection('customers').doc(customerId).get();
const invoices = await db.collection('invoices')
  .where('customer.id', '==', customerId)
  .get();
```

### 3. Search invoices by customer mobile:
```javascript
const invoices = await db.collection('invoices')
  .where('customer.mobile', '==', mobileNumber)
  .get();
```

## Data Integrity Rules

1. **Customer Reference**: Every invoice must have a valid customer.id
2. **Invoice Numbering**: Unique invoice numbers with format INV-YYYYMM-XXXX
3. **Status Management**: Invoice status must be one of: PENDING, PAID, PARTIAL
4. **Amount Calculations**: totalAmount = sum of all serviceDetails.amount
5. **Balance Tracking**: balancePayable = totalAmount - advanceReceived

## Benefits of This Structure

1. **Performance**: Fast queries for both customers and invoices
2. **Data Integrity**: Customer information snapshot preserves historical accuracy
3. **Flexibility**: Can update customer master data without affecting invoices
4. **Reporting**: Easy to generate customer-wise and invoice-wise reports
5. **Search**: Multiple search options (by customer name, mobile, invoice number)

## Collection Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /customers/{document} {
      allow read, write: if true; // Add authentication later
    }
    
    match /invoices/{document} {
      allow read, write: if true; // Add authentication later
    }
  }
}
```

## Sample Data Creation

To test the system, create:
1. A few customers in the `customers` collection
2. Invoices linked to those customers in the `invoices` collection
3. Test different invoice statuses (PENDING, PAID, PARTIAL)

This structure ensures proper data relationships while maintaining performance and flexibility for your Global Financial Services application.
