<div class="dashboard">
  <div class="dashboard-header">
    <h2>Home</h2>
    <button (click)="logout()" class="logout-btn">
      <i class="fas fa-sign-out-alt"></i>
      <span>Logout</span>
    </button>
  </div>

  <!-- Main Category Buttons -->
  <div class="main-categories">
    <button (click)="setActiveCategory('customers')" [class.active]="activeCategory === 'customers'">
      <i class="fas fa-users"></i>
      <span>Customers</span>
    </button>
    <button (click)="setActiveCategory('invoices')" [class.active]="activeCategory === 'invoices'">
      <i class="fas fa-file-invoice"></i>
      <span>Invoices</span>
    </button>
    <button (click)="setActiveCategory('revenue')" [class.active]="activeCategory === 'revenue'">
      <i class="fas fa-chart-line"></i>
      <span>Revenue Dashboard</span>
    </button>
  </div>

  <!-- Customers Sub-Functions -->
  <div *ngIf="activeCategory === 'customers'" class="sub-functions">
    <h3>Customer Management</h3>
    <div class="actions">
      <button (click)="setActiveSection('addCustomer')" [class.active]="activeSection === 'addCustomer'">
        <i class="fas fa-user-plus"></i> Add Customer
      </button>
      <button (click)="setActiveSection('viewCustomers')" [class.active]="activeSection === 'viewCustomers'">
        <i class="fas fa-users"></i> View Customers
      </button>
    </div>
  </div>

  <!-- Invoices Sub-Functions -->
  <div *ngIf="activeCategory === 'invoices'" class="sub-functions">
    <h3>Invoice Management</h3>
    <div class="actions">
      <button (click)="setActiveSection('createInvoice')" [class.active]="activeSection === 'createInvoice'">
        <i class="fas fa-plus-circle"></i> Create Invoice
      </button>
      <button (click)="setActiveSection('viewInvoices')" [class.active]="activeSection === 'viewInvoices'">
        <i class="fas fa-file-invoice-dollar"></i> View Invoices
      </button>
    </div>
  </div>

  <!-- Revenue Dashboard Sub-Functions -->
  <div *ngIf="activeCategory === 'revenue'" class="sub-functions">
    <h3>Revenue Analytics</h3>
    <div class="actions">
      <button (click)="setActiveSection('monthlyRevenue')" [class.active]="activeSection === 'monthlyRevenue'">
        <i class="fas fa-calendar-alt"></i> Monthly Revenue
      </button>
      <button (click)="setActiveSection('customerRevenue')" [class.active]="activeSection === 'customerRevenue'">
        <i class="fas fa-user-chart"></i> Customer Revenue
      </button>
      <button (click)="setActiveSection('revenueReports')" [class.active]="activeSection === 'revenueReports'">
        <i class="fas fa-chart-bar"></i> Revenue Reports
      </button>
    </div>
  </div>

  <!-- Add Customer Form -->
  <div *ngIf="activeCategory === 'customers' && activeSection === 'addCustomer'" class="section-container">
    <h3>Add New Customer</h3>
    <form (ngSubmit)="addCustomer()" class="customer-form">
      <!-- Customer Type Selection -->
      <div class="form-section">
        <h4>Customer Type</h4>
        <div class="form-row">
          <div class="form-group">
            <label>
              <input type="radio" name="customerType" value="individual" [(ngModel)]="newCustomer.customerType" />
              Individual
            </label>
            <label>
              <input type="radio" name="customerType" value="company" [(ngModel)]="newCustomer.customerType" />
              Company
            </label>
          </div>
        </div>
      </div>

      <!-- Name Section for Individual -->
      <div *ngIf="newCustomer.customerType === 'individual'" class="form-section">
        <h4>Customer Name</h4>
        <div class="form-row">
          <div class="form-group small">
            <label for="prefix">Prefix</label>
            <select id="prefix" [(ngModel)]="newCustomer.prefix" name="prefix" required>
              <option value="Mr.">Mr.</option>
              <option value="Mrs.">Mrs.</option>
              <option value="Ms.">Ms.</option>
              <option value="Dr.">Dr.</option>
              <option value="Prof.">Prof.</option>
            </select>
          </div>
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input id="firstName" type="text" [(ngModel)]="newCustomer.firstName" name="firstName" placeholder="Enter first name" required />
          </div>
          <div class="form-group">
            <label for="middleName">Middle Name</label>
            <input id="middleName" type="text" [(ngModel)]="newCustomer.middleName" name="middleName" placeholder="Enter middle name" />
          </div>
          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input id="lastName" type="text" [(ngModel)]="newCustomer.lastName" name="lastName" placeholder="Enter last name" required />
          </div>
        </div>
      </div>

      <!-- Name Section for Company -->
      <div *ngIf="newCustomer.customerType === 'company'" class="form-section">
        <h4>Company Information</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="companyName">Company Name *</label>
            <input id="companyName" type="text" [(ngModel)]="newCustomer.companyName" name="companyName" placeholder="Enter company name" required />
          </div>
          <div class="form-group">
            <label for="companyType">Company Type *</label>
            <select id="companyType" [(ngModel)]="newCustomer.companyType" name="companyType" required>
              <option value="">Select Company Type</option>
              <option *ngFor="let type of companyTypes" [value]="type">{{type}}</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Contact Section -->
      <div class="form-section">
        <h4>Contact Information</h4>
        <div class="form-row">
          <div class="form-group small">
            <label for="countryCode">Country Code</label>
            <select id="countryCode" [(ngModel)]="newCustomer.countryCode" name="countryCode" required>
              <option value="+91">+91 (India)</option>
              <option value="+1">+1 (USA)</option>
              <option value="+44">+44 (UK)</option>
              <option value="+971">+971 (UAE)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="mobile">Mobile Number *</label>
            <input id="mobile" type="text" [(ngModel)]="newCustomer.mobile" name="mobile" placeholder="Enter mobile number" required />
          </div>
          <div class="form-group">
            <label for="email">Email Address</label>
            <input id="email" type="email" [(ngModel)]="newCustomer.email" name="email" placeholder="Enter email address" />
          </div>
          <div class="form-group">
            <label for="gst">GST Number</label>
            <input id="gst" type="text" [(ngModel)]="newCustomer.gst" name="gst" placeholder="Enter GST number" />
          </div>
        </div>
      </div>

      <!-- Address Section -->
      <div class="form-section">
        <h4>Address Information</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="flatNumber">Flat/House Number</label>
            <input id="flatNumber" type="text" [(ngModel)]="newCustomer.flatNumber" name="flatNumber" placeholder="Enter flat/house number" />
          </div>
          <div class="form-group">
            <label for="buildingName">Building/Society Name</label>
            <input id="buildingName" type="text" [(ngModel)]="newCustomer.buildingName" name="buildingName" placeholder="Enter building name" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="streetName">Street Name</label>
            <input id="streetName" type="text" [(ngModel)]="newCustomer.streetName" name="streetName" placeholder="Enter street name" />
          </div>
          <div class="form-group">
            <label for="village">Village/City *</label>
            <input id="village" type="text" [(ngModel)]="newCustomer.village" name="village" placeholder="Enter village/city" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="taluka">Taluka</label>
            <input id="taluka" type="text" [(ngModel)]="newCustomer.taluka" name="taluka" placeholder="Enter taluka" />
          </div>
          <div class="form-group">
            <label for="district">District *</label>
            <input id="district" type="text" [(ngModel)]="newCustomer.district" name="district" placeholder="Enter district" required />
          </div>
          <div class="form-group">
            <label for="pincode">Pincode</label>
            <input id="pincode" type="text" [(ngModel)]="newCustomer.pincode" name="pincode" placeholder="Enter pincode" />
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" (click)="setActiveSection(null)" class="cancel-btn">Cancel</button>
        <button type="submit" class="submit-btn">Add Customer</button>
      </div>
    </form>
  </div>

  <!-- View Customers -->
  <div *ngIf="activeCategory === 'customers' && activeSection === 'viewCustomers'" class="section-container">
    <h3>All Customers</h3>
    <div class="customer-stats">
      <div class="stat-card">
        <h4>Total Customers</h4>
        <p class="stat-number">{{customers.length}}</p>
      </div>
      <div class="stat-card">
        <h4>Total Due Amount</h4>
        <p class="stat-number due-amount">₹{{totalDueAmount}}</p>
      </div>
    </div>

    <div class="customer-list">
      <div *ngFor="let customer of customers" class="customer-card">
        <div class="customer-header">
          <h4>{{customer.name}}</h4>
          <div class="customer-actions">
            <button class="edit-btn" (click)="editCustomer(customer.id!)">✏️ Edit</button>
            <button class="delete-btn" (click)="deleteCustomer(customer.id!)">🗑️ Delete</button>
          </div>
        </div>
        
        <div class="customer-details">
          <div class="detail-row">
            <span class="label">📱 Mobile:</span>
            <span class="value">{{customer.mobile}}</span>
          </div>
          
          <div class="detail-row" *ngIf="customer.gst">
            <span class="label">🏢 GST Number:</span>
            <span class="value">{{customer.gst}}</span>
          </div>
          
          <div class="detail-row" *ngIf="customer.email">
            <span class="label">📧 Email:</span>
            <span class="value">{{customer.email}}</span>
          </div>
          
          <div class="detail-row">
            <span class="label">📍 Address:</span>
            <span class="value">{{customer.address}}</span>
          </div>
          
          <div class="detail-row due-row">
            <span class="label">💰 Due Amount:</span>
            <span class="value due-amount" [class.no-due]="customer.dueAmount === 0">
              ₹{{customer.dueAmount}}
              <span *ngIf="customer.dueAmount === 0" class="paid-badge">PAID</span>
            </span>
          </div>
        </div>
      </div>
      
      <div *ngIf="customers.length === 0" class="no-customers">
        <p>No customers found. Add your first customer using the Add Customer form.</p>
      </div>
    </div>
  </div>

  <!-- Create Invoice -->
  <div *ngIf="activeCategory === 'invoices' && activeSection === 'createInvoice'" class="section-container">
    <h3>Create Invoice</h3>
    <form (ngSubmit)="saveInvoice()" class="customer-form">
      <!-- Invoice Basic Details -->
      <div class="form-section">
        <h4>📋 Invoice Details</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="invoiceNumber">Invoice Number</label>
            <input 
              type="text" 
              id="invoiceNumber" 
              [(ngModel)]="invoice.invoiceNumber" 
              name="invoiceNumber"
              class="form-control">
          </div>
          <div class="form-group">
            <label for="invoiceDate">Invoice Date</label>
            <input 
              type="date" 
              id="invoiceDate" 
              [(ngModel)]="invoice.invoiceDate" 
              name="invoiceDate"
              class="form-control">
          </div>
        </div>
      </div>

      <!-- Customer Selection -->
      <div class="form-section">
        <h4>👤 Customer Details</h4>
        
        <div class="radio-group">
          <label class="radio-option">
            <input 
              type="radio" 
              [(ngModel)]="invoice.customerType" 
              name="customerType" 
              value="existing"
              (change)="onCustomerTypeChange()">
            <span>Existing Customer</span>
          </label>
          <label class="radio-option">
            <input 
              type="radio" 
              [(ngModel)]="invoice.customerType" 
              name="customerType" 
              value="new"
              (change)="onCustomerTypeChange()">
            <span>New Customer</span>
          </label>
        </div>

        <!-- Existing Customer Search -->
        <div *ngIf="invoice.customerType === 'existing'" class="customer-search">
          <div class="form-group">
            <label for="customerSearch">Search Customer (Name or Mobile)</label>
            <input 
              type="text" 
              id="customerSearch"
              [(ngModel)]="invoice.searchTerm" 
              name="customerSearch"
              placeholder="Enter customer name or mobile number"
              class="form-control"
              (input)="searchCustomer()">
          </div>

          <!-- Search Results -->
          <div *ngIf="searchResults.length > 0" class="search-results">
            <div 
              *ngFor="let customer of searchResults" 
              class="customer-result"
              (click)="selectCustomer(customer)">
              <div class="customer-info">
                <span class="customer-name">{{customer.name}}</span>
                <span class="customer-mobile">{{customer.mobile}}</span>
                <span class="customer-email">{{customer.email}}</span>
              </div>
            </div>
          </div>

          <!-- Selected Customer Display -->
          <div *ngIf="invoice.customer" class="selected-customer">
            <h4>Selected Customer:</h4>
            <div class="customer-card">
              <p><strong>{{invoice.customer.name}}</strong></p>
              <p>Mobile: {{invoice.customer.mobile}}</p>
              <p>Email: {{invoice.customer.email}}</p>
              <p>Address: {{invoice.customer.address}}</p>
            </div>
          </div>

          <!-- Add New Customer Button - Only show when no customer is selected and search has no results -->
          <button 
            *ngIf="!invoice.customer && invoice.searchTerm && searchResults.length === 0" 
            type="button" 
            class="add-customer-btn"
            (click)="showAddNewCustomer()">
            + Add New Customer
          </button>
        </div>

        <!-- New Customer Form -->
        <div *ngIf="invoice.customerType === 'new' || showAddCustomerForm" class="new-customer-form">
          <h4>Add Customer Details</h4>
          
          <!-- Customer Type Selection -->
          <div class="form-row">
            <div class="form-group">
              <label>Customer Type:</label>
              <label>
                <input type="radio" name="invoiceCustomerType" value="individual" [(ngModel)]="newInvoiceCustomer.customerType" />
                Individual
              </label>
              <label>
                <input type="radio" name="invoiceCustomerType" value="company" [(ngModel)]="newInvoiceCustomer.customerType" />
                Company
              </label>
            </div>
          </div>

          <!-- Individual Customer Form -->
          <div *ngIf="newInvoiceCustomer.customerType === 'individual'">
            <div class="form-row">
              <div class="form-group small">
                <label for="prefix">Prefix</label>
                <select id="prefix" [(ngModel)]="newInvoiceCustomer.prefix" name="prefix">
                  <option value="Mr.">Mr.</option>
                  <option value="Ms.">Ms.</option>
                  <option value="Mrs.">Mrs.</option>
                  <option value="Dr.">Dr.</option>
                </select>
              </div>
              <div class="form-group">
                <label for="firstName">First Name *</label>
                <input 
                  type="text" 
                  id="firstName" 
                  [(ngModel)]="newInvoiceCustomer.firstName" 
                  name="firstName"
                  required>
              </div>
              <div class="form-group">
                <label for="middleName">Middle Name</label>
                <input 
                  type="text" 
                  id="middleName" 
                  [(ngModel)]="newInvoiceCustomer.middleName" 
                  name="middleName">
              </div>
              <div class="form-group">
                <label for="lastName">Last Name *</label>
                <input 
                  type="text" 
                  id="lastName" 
                  [(ngModel)]="newInvoiceCustomer.lastName" 
                  name="lastName"
                  required>
              </div>
            </div>
          </div>

          <!-- Company Customer Form -->
          <div *ngIf="newInvoiceCustomer.customerType === 'company'">
            <div class="form-row">
              <div class="form-group">
                <label for="companyName">Company Name *</label>
                <input 
                  type="text" 
                  id="companyName" 
                  [(ngModel)]="newInvoiceCustomer.companyName" 
                  name="companyName"
                  placeholder="Enter company name"
                  required>
              </div>
              <div class="form-group">
                <label for="companyType">Company Type *</label>
                <select id="companyType" [(ngModel)]="newInvoiceCustomer.companyType" name="companyType" required>
                  <option value="">Select Company Type</option>
                  <option *ngFor="let type of companyTypes" [value]="type">{{type}}</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Contact Information -->
          <div class="form-row">
            <div class="form-group small">
              <label for="countryCode">Country Code</label>
              <select id="countryCode" [(ngModel)]="newInvoiceCustomer.countryCode" name="countryCode" required>
                <option value="+91">+91 (India)</option>
                <option value="+1">+1 (USA)</option>
                <option value="+44">+44 (UK)</option>
                <option value="+971">+971 (UAE)</option>
              </select>
            </div>
            <div class="form-group">
              <label for="mobile">Mobile Number *</label>
              <input 
                type="tel" 
                id="mobile" 
                [(ngModel)]="newInvoiceCustomer.mobile" 
                name="mobile"
                placeholder="Enter mobile number"
                required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input 
                type="email" 
                id="email" 
                [(ngModel)]="newInvoiceCustomer.email" 
                name="email"
                placeholder="Enter email address">
            </div>
            <div class="form-group">
              <label for="gst">GST Number</label>
              <input 
                type="text" 
                id="gst" 
                [(ngModel)]="newInvoiceCustomer.gst" 
                name="gst"
                placeholder="Enter GST number">
            </div>
          </div>

          <!-- Address Information -->
          <div class="form-row">
            <div class="form-group">
              <label for="flatNumber">Flat/House Number</label>
              <input 
                type="text" 
                id="flatNumber" 
                [(ngModel)]="newInvoiceCustomer.flatNumber" 
                name="flatNumber"
                placeholder="Enter flat/house number">
            </div>
            <div class="form-group">
              <label for="buildingName">Building/Society Name</label>
              <input 
                type="text" 
                id="buildingName" 
                [(ngModel)]="newInvoiceCustomer.buildingName" 
                name="buildingName"
                placeholder="Enter building name">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="streetName">Street Name</label>
              <input 
                type="text" 
                id="streetName" 
                [(ngModel)]="newInvoiceCustomer.streetName" 
                name="streetName"
                placeholder="Enter street name">
            </div>
            <div class="form-group">
              <label for="village">Village/City *</label>
              <input 
                type="text" 
                id="village" 
                [(ngModel)]="newInvoiceCustomer.village" 
                name="village"
                placeholder="Enter village/city"
                required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="taluka">Taluka</label>
              <input 
                type="text" 
                id="taluka" 
                [(ngModel)]="newInvoiceCustomer.taluka" 
                name="taluka"
                placeholder="Enter taluka">
            </div>
            <div class="form-group">
              <label for="district">District *</label>
              <input 
                type="text" 
                id="district" 
                [(ngModel)]="newInvoiceCustomer.district" 
                name="district"
                placeholder="Enter district"
                required>
            </div>
            <div class="form-group">
              <label for="pincode">Pincode</label>
              <input 
                type="text" 
                id="pincode" 
                [(ngModel)]="newInvoiceCustomer.pincode" 
                name="pincode"
                placeholder="Enter pincode">
            </div>
          </div>

          <button *ngIf="showAddCustomerForm" type="button" class="submit-btn" (click)="addNewInvoiceCustomer()">
            Save Customer
          </button>
        </div>
      </div>

      <!-- Service Details -->
      <div class="form-section">
        <h4>💼 Service Details</h4>
        
        <div *ngFor="let service of invoice.serviceDetails; let i = index" class="service-item">
          <div class="service-header">
            <h4>Service {{i + 1}}</h4>
            <button 
              *ngIf="invoice.serviceDetails.length > 1"
              type="button" 
              class="remove-service-btn"
              (click)="removeServiceDetail(i)">
              ✕
            </button>
          </div>
          
          <div class="form-group">
            <label for="description{{i}}">Service Description / Particulars *</label>
            <input 
              type="text" 
              id="description{{i}}"
              [(ngModel)]="service.description" 
              name="description{{i}}"
              placeholder="e.g., Incorporation of Producer Company, ITR filing, GST filing"
              list="serviceOptions">
            <datalist id="serviceOptions">
              <option *ngFor="let option of serviceOptions" [value]="option">
            </datalist>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="amount{{i}}">Amount *</label>
              <input 
                type="number" 
                id="amount{{i}}"
                [(ngModel)]="service.amount" 
                name="amount{{i}}"
                min="0"
                step="0.01"
                (input)="onAmountChange()">
            </div>
            <div class="form-group">
              <label for="notes{{i}}">Notes (Optional)</label>
              <input 
                type="text" 
                id="notes{{i}}"
                [(ngModel)]="service.notes" 
                name="notes{{i}}"
                placeholder="e.g., Including challan fees">
            </div>
          </div>
        </div>

        <button type="button" class="add-service-btn" (click)="addServiceDetail()">
          + Add Another Service
        </button>
      </div>

      <!-- Payment Summary -->
      <div class="form-section">
        <h4>💰 Payment Summary</h4>
        
        <div class="payment-summary">
          <div class="summary-row">
            <span class="label">Total Amount:</span>
            <span class="amount">₹{{invoice.totalAmount | number:'1.2-2'}}</span>
          </div>
          
          <div class="form-group">
            <label for="advanceReceived">Advance Received</label>
            <input 
              type="number" 
              id="advanceReceived"
              [(ngModel)]="invoice.advanceReceived" 
              name="advanceReceived"
              min="0"
              step="0.01"
              (input)="onAdvanceChange()">
          </div>
          
          <div class="summary-row total">
            <span class="label">Balance / Net Payable:</span>
            <span class="amount">₹{{invoice.balancePayable | number:'1.2-2'}}</span>
          </div>
        </div>
      </div>

      <!-- Bank Account Selection -->
      <div class="form-section">
        <h4>🏦 Bank Account</h4>
        <div class="form-group">
          <label for="bankAccount">Select Bank Account (To Receive Amount) *</label>
          <select id="bankAccount" [(ngModel)]="invoice.selectedBank" name="bankAccount" required>
            <option value="">Select Bank Account</option>
            <option *ngFor="let bank of bankAccounts" [value]="bank">{{bank}}</option>
          </select>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-actions">
        <button type="button" (click)="setActiveSection(null)" class="cancel-btn">Cancel</button>
        <button type="submit" class="submit-btn">Create Invoice</button>
      </div>
    </form>
  </div>

  <!-- View Invoices -->
  <div *ngIf="activeCategory === 'invoices' && activeSection === 'viewInvoices'" class="section-container">
    <h3>View Invoices</h3>

    <!-- Invoice Search and Filter Section -->
    <div class="invoice-search-section">
      <div class="form-row">
        <div class="form-group">
          <label for="invoiceSearch">Search Invoices</label>
          <input 
            type="text" 
            id="invoiceSearch"
            [(ngModel)]="invoiceSearchTerm" 
            name="invoiceSearch"
            placeholder="Search by invoice number, customer name, or mobile number"
            (input)="onInvoiceSearch()">
        </div>
        <div class="form-group">
          <label for="statusFilter">Filter by Status</label>
          <select 
            id="statusFilter" 
            [(ngModel)]="selectedInvoiceStatus" 
            name="statusFilter"
            (change)="onStatusFilterChange()">
            <option value="ALL">All Invoices</option>
            <option value="PAID">Paid</option>
            <option value="PARTIAL">Partially Paid</option>
            <option value="PENDING">Pending</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Invoice Statistics -->
    <div class="invoice-stats">
      <div class="stat-card">
        <h4>Total Invoices</h4>
        <p class="stat-number">{{invoices.length}}</p>
      </div>
      <div class="stat-card">
        <h4>Total Amount</h4>
        <p class="stat-number">₹{{totalInvoiceAmount | number:'1.2-2'}}</p>
      </div>
      <div class="stat-card">
        <h4>Pending Amount</h4>
        <p class="stat-number due-amount">₹{{totalPendingAmount | number:'1.2-2'}}</p>
      </div>
      <div class="stat-card">
        <h4>Paid Invoices</h4>
        <p class="stat-number paid">{{paidInvoicesCount}}</p>
      </div>
    </div>

    <!-- Invoice List -->
    <div class="invoice-list">
      <div *ngFor="let invoice of filteredInvoices" class="invoice-card">
        <div class="invoice-header">
          <div class="invoice-basic-info">
            <h4>{{invoice.invoiceNumber}}</h4>
            <span class="invoice-date">{{invoice.invoiceDate | date:'shortDate'}}</span>
            <span class="status-badge" [class]="'status-' + invoice.status.toLowerCase()">
              {{invoice.status}}
            </span>
          </div>
          <div class="invoice-actions">
            <button class="view-btn" (click)="printInvoice(invoice.id!)" title="Print Invoice">
              <i class="fas fa-print"></i> Print
            </button>
            <button class="whatsapp-btn" (click)="shareOnWhatsApp(invoice.id!)" title="Share on WhatsApp">
              <i class="fab fa-whatsapp"></i> WhatsApp
            </button>
            <button class="edit-btn" (click)="editInvoice(invoice.id!)" title="Edit Invoice">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="delete-btn" (click)="deleteInvoice(invoice.id!)" title="Delete Invoice">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
        
        <div class="invoice-details">
          <!-- Customer Information -->
          <div class="invoice-section">
            <h5>👤 Customer Details</h5>
            <div class="detail-row">
              <span class="label">Name:</span>
              <span class="value">{{invoice.customer.name}}</span>
            </div>
            <div class="detail-row">
              <span class="label">� Mobile:</span>
              <span class="value">{{invoice.customer.mobile}}</span>
            </div>
            <div class="detail-row" *ngIf="invoice.customer.email">
              <span class="label">📧 Email:</span>
              <span class="value">{{invoice.customer.email}}</span>
            </div>
            <div class="detail-row">
              <span class="label">📍 Address:</span>
              <span class="value">{{invoice.customer.address}}</span>
            </div>
          </div>

          <!-- Service Details -->
          <div class="invoice-section">
            <h5>💼 Services</h5>
            <div class="service-list">
              <div *ngFor="let service of invoice.serviceDetails" class="service-row">
                <div class="service-info">
                  <span class="service-description">{{service.description}}</span>
                  <span class="service-notes" *ngIf="service.notes">({{service.notes}})</span>
                </div>
                <span class="service-amount">₹{{service.amount | number:'1.2-2'}}</span>
              </div>
            </div>
          </div>

          <!-- Payment Summary -->
          <div class="invoice-section">
            <h5>💰 Payment Summary</h5>
            <div class="payment-details">
              <div class="payment-row">
                <span class="label">Total Amount:</span>
                <span class="value">₹{{invoice.totalAmount | number:'1.2-2'}}</span>
              </div>
              <div class="payment-row">
                <span class="label">Advance Received:</span>
                <span class="value">₹{{invoice.advanceReceived | number:'1.2-2'}}</span>
              </div>
              <div class="payment-row total">
                <span class="label">Balance Payable:</span>
                <span class="value" [class.paid]="invoice.balancePayable === 0">
                  ₹{{invoice.balancePayable | number:'1.2-2'}}
                  <span *ngIf="invoice.balancePayable === 0" class="paid-badge">FULLY PAID</span>
                </span>
              </div>
              <div class="payment-row">
                <span class="label">Bank Account:</span>
                <span class="value bank-info">{{invoice.selectedBank}}</span>
              </div>
            </div>
          </div>

          <!-- Status Update Actions -->
          <div class="invoice-section status-actions">
            <h5>Status Management</h5>
            <div class="status-buttons">
              <button 
                *ngIf="invoice.status !== 'PAID'"
                class="status-btn paid-btn" 
                (click)="updateInvoiceStatus(invoice.id!, 'PAID')">
                Mark as Paid
              </button>
              <button 
                *ngIf="invoice.status !== 'PARTIAL'"
                class="status-btn partial-btn" 
                (click)="updateInvoiceStatus(invoice.id!, 'PARTIAL')">
                Mark as Partial
              </button>
              <button 
                *ngIf="invoice.status !== 'PENDING'"
                class="status-btn pending-btn" 
                (click)="updateInvoiceStatus(invoice.id!, 'PENDING')">
                Mark as Pending
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="filteredInvoices.length === 0 && invoices.length > 0" class="no-invoices">
        <p>No invoices found matching your search criteria.</p>
        <button (click)="invoiceSearchTerm = ''; selectedInvoiceStatus = 'ALL'; filterInvoices()" class="clear-filters-btn">
          Clear Filters
        </button>
      </div>

      <div *ngIf="invoices.length === 0" class="no-invoices">
        <p>No invoices created yet. Create your first invoice using the Create Invoice form.</p>
      </div>
    </div>
  </div>

  <!-- Monthly Revenue Section -->
  <div *ngIf="activeCategory === 'revenue' && activeSection === 'monthlyRevenue'" class="section-container">
    <h3>Monthly Revenue Overview</h3>
    <div class="revenue-cards">
      <div class="revenue-card">
        <h4>This Month</h4>
        <div class="revenue-amount">₹{{getCurrentMonthRevenue() | number:'1.2-2'}}</div>
        <div class="revenue-trend positive">+12% from last month</div>
      </div>
      <div class="revenue-card">
        <h4>Last Month</h4>
        <div class="revenue-amount">₹{{getLastMonthRevenue() | number:'1.2-2'}}</div>
        <div class="revenue-trend">Previous period</div>
      </div>
      <div class="revenue-card">
        <h4>Average Monthly</h4>
        <div class="revenue-amount">₹{{getAverageMonthlyRevenue() | number:'1.2-2'}}</div>
        <div class="revenue-trend">6-month average</div>
      </div>
    </div>
    <div class="chart-container">
      <h4>Monthly Revenue Trend</h4>
      <div class="chart-placeholder">
        <p>📊 Chart will display monthly revenue trends</p>
        <small>Integration with charting library can be added here</small>
      </div>
    </div>
  </div>

  <!-- Customer Revenue Section -->
  <div *ngIf="activeCategory === 'revenue' && activeSection === 'customerRevenue'" class="section-container">
    <h3>Customer Revenue Analysis</h3>
    <div class="customer-revenue-list">
      <div class="customer-revenue-header">
        <span>Customer</span>
        <span>Total Revenue</span>
        <span>Invoices</span>
        <span>Outstanding</span>
      </div>
      <div *ngFor="let customer of getCustomerRevenueData()" class="customer-revenue-row">
        <span class="customer-name">{{customer.name}}</span>
        <span class="revenue-amount">₹{{customer.totalRevenue | number:'1.2-2'}}</span>
        <span class="invoice-count">{{customer.invoiceCount}}</span>
        <span class="outstanding" [class.paid]="customer.outstanding === 0">
          ₹{{customer.outstanding | number:'1.2-2'}}
        </span>
      </div>
    </div>
  </div>

  <!-- Revenue Reports Section -->
  <div *ngIf="activeCategory === 'revenue' && activeSection === 'revenueReports'" class="section-container">
    <h3>Revenue Reports & Analytics</h3>
    <div class="report-options">
      <div class="report-card">
        <h4>📊 Income Statement</h4>
        <p>Detailed breakdown of revenue, expenses, and profit</p>
        <button class="report-btn" (click)="generateIncomeStatement()">Generate Report</button>
      </div>
      <div class="report-card">
        <h4>📈 Revenue Growth</h4>
        <p>Year-over-year and month-over-month growth analysis</p>
        <button class="report-btn" (click)="generateGrowthReport()">Generate Report</button>
      </div>
      <div class="report-card">
        <h4>💰 Payment Analytics</h4>
        <p>Payment patterns, collection efficiency, and aging analysis</p>
        <button class="report-btn" (click)="generatePaymentReport()">Generate Report</button>
      </div>
      <div class="report-card">
        <h4>📋 Tax Summary</h4>
        <p>GST and tax summaries for compliance reporting</p>
        <button class="report-btn" (click)="generateTaxReport()">Generate Report</button>
      </div>
    </div>
    <div class="quick-stats">
      <h4>Quick Statistics</h4>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">Total Revenue (YTD)</span>
          <span class="stat-value">₹{{getYearToDateRevenue() | number:'1.2-2'}}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total Outstanding</span>
          <span class="stat-value">₹{{getTotalOutstanding() | number:'1.2-2'}}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Collection Rate</span>
          <span class="stat-value">{{getCollectionRate()}}%</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Active Customers</span>
          <span class="stat-value">{{getActiveCustomersCount()}}</span>
        </div>
      </div>
    </div>
  </div>
</div>
