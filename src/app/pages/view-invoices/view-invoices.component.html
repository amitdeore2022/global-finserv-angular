<div class="view-invoices">
  <div class="dashboard-header">
    <h2>View Invoices</h2>
    <button (click)="goBackToDashboard()" class="back-btn">
      <i class="fas fa-arrow-left"></i>
      <span>Back to Dashboard</span>
    </button>
  </div>

  <!-- Invoice Search and Filter Section -->
  <div class="invoice-search-section">
    <div class="form-row">
      <div class="form-group">
        <label for="invoiceSearch">Search Invoices</label>
        <input 
          type="text" 
          id="invoiceSearch"
          [(ngModel)]="invoiceSearchTerm" 
          name="invoiceSearch"
          placeholder="Search by invoice number, customer name, or mobile number"
          (input)="onInvoiceSearch()">
      </div>
      <div class="form-group">
        <label for="statusFilter">Filter by Status</label>
        <select 
          id="statusFilter" 
          [(ngModel)]="selectedInvoiceStatus" 
          name="statusFilter"
          (change)="onStatusFilterChange()">
          <option value="ALL">All Invoices</option>
          <option value="PAID">Paid</option>
          <option value="PARTIAL">Partially Paid</option>
          <option value="PENDING">Pending</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Invoice Statistics -->
  <div class="invoice-stats">
    <div class="stat-card">
      <h4>Total Invoices</h4>
      <p class="stat-number">{{invoices.length}}</p>
    </div>
    <div class="stat-card">
      <h4>Total Amount</h4>
      <p class="stat-number">‚Çπ{{totalInvoiceAmount | number:'1.2-2'}}</p>
    </div>
    <div class="stat-card">
      <h4>Pending Amount</h4>
      <p class="stat-number due-amount">‚Çπ{{totalPendingAmount | number:'1.2-2'}}</p>
    </div>
    <div class="stat-card">
      <h4>Paid Invoices</h4>
      <p class="stat-number paid">{{paidInvoicesCount}}</p>
    </div>
  </div>

  <!-- Invoice List -->
  <div class="invoice-list">
    <div *ngFor="let invoice of filteredInvoices" class="invoice-card">
      <div class="invoice-header">
        <div class="invoice-basic-info">
          <h4>{{invoice.invoiceNumber}}</h4>
          <span class="invoice-date">{{invoice.invoiceDate | date:'shortDate'}}</span>
          <span class="status-badge" [class]="'status-' + invoice.status.toLowerCase()">
            {{invoice.status}}
          </span>
        </div>
        <div class="invoice-actions">
          <button class="view-btn" (click)="printInvoice(invoice.id!)" title="Print Invoice">
            <i class="fas fa-print"></i> Print
          </button>
          <button class="whatsapp-btn" (click)="shareOnWhatsApp(invoice.id!)" title="Share on WhatsApp">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </button>
          <button class="edit-btn" (click)="editInvoice(invoice.id!)" title="Edit Invoice">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="delete-btn" (click)="deleteInvoice(invoice.id!)" title="Delete Invoice">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
      
      <div class="invoice-details">
        <!-- Customer Information -->
        <div class="invoice-section">
          <h5>üë§ Customer Details</h5>
          <div class="detail-row">
            <span class="label">Name:</span>
            <span class="value">{{invoice.customer.name}}</span>
          </div>
          <div class="detail-row">
            <span class="label">üì± Mobile:</span>
            <span class="value">{{invoice.customer.mobile}}</span>
          </div>
          <div class="detail-row" *ngIf="invoice.customer.email">
            <span class="label">üìß Email:</span>
            <span class="value">{{invoice.customer.email}}</span>
          </div>
          <div class="detail-row">
            <span class="label">üìç Address:</span>
            <span class="value">{{invoice.customer.address}}</span>
          </div>
        </div>

        <!-- Service Details -->
        <div class="invoice-section">
          <h5>üíº Services</h5>
          <div class="service-list">
            <div *ngFor="let service of invoice.serviceDetails" class="service-row">
              <div class="service-info">
                <span class="service-description">{{service.description}}</span>
              </div>
              <span class="service-amount">‚Çπ{{service.amount | number:'1.2-2'}}</span>
            </div>
          </div>
        </div>

        <!-- Payment Summary -->
        <div class="invoice-section">
          <h5>üí∞ Payment Summary</h5>
          <div class="payment-details">
            <div class="payment-row">
              <span class="label">Total Amount:</span>
              <span class="value">‚Çπ{{invoice.totalAmount | number:'1.2-2'}}</span>
            </div>
            <div class="payment-row">
              <span class="label">Advance Received:</span>
              <span class="value">‚Çπ{{invoice.advanceReceived | number:'1.2-2'}}</span>
            </div>
            <div class="payment-row total">
              <span class="label">Balance Payable:</span>
              <span class="value" [class.paid]="invoice.balancePayable === 0">
                ‚Çπ{{invoice.balancePayable | number:'1.2-2'}}
                <span *ngIf="invoice.balancePayable === 0" class="paid-badge">FULLY PAID</span>
              </span>
            </div>
            <div class="payment-row">
              <span class="label">Bank Account:</span>
              <span class="value bank-info">{{invoice.selectedBank}}</span>
            </div>
          </div>
        </div>

        <!-- Status Update Actions -->
        <div class="invoice-section status-actions">
          <h5>Status Management</h5>
          <div class="status-buttons">
            <button 
              *ngIf="invoice.status !== 'PAID'"
              class="status-btn paid-btn" 
              (click)="updateInvoiceStatus(invoice.id!, 'PAID')">
              Mark as Paid
            </button>
            <button 
              *ngIf="invoice.status !== 'PARTIAL'"
              class="status-btn partial-btn" 
              (click)="updateInvoiceStatus(invoice.id!, 'PARTIAL')">
              Mark as Partial
            </button>
            <button 
              *ngIf="invoice.status !== 'PENDING'"
              class="status-btn pending-btn" 
              (click)="updateInvoiceStatus(invoice.id!, 'PENDING')">
              Mark as Pending
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div *ngIf="filteredInvoices.length === 0 && invoices.length > 0" class="no-invoices">
      <p>No invoices found matching your search criteria.</p>
      <button (click)="invoiceSearchTerm = ''; selectedInvoiceStatus = 'ALL'; filterInvoices()" class="clear-filters-btn">
        Clear Filters
      </button>
    </div>

    <div *ngIf="invoices.length === 0" class="no-invoices">
      <p>No invoices created yet. Create your first invoice using the Create Invoice form.</p>
    </div>
  </div>
</div>
